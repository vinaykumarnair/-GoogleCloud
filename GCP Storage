   of 6   
MODULE 5 | STORAGEGCP - MOD. 5 - STORAGE CLOUD DEPLOYMENT PROJECT (HANDS-ON)SOLUTION:INTERCONTINENTAL VM MIGRATION (USA >> AUSTRALIA)USING STORAGE SNAPSHOT THROUGH THE GCP INTERNAL PRIVATE NETWORKIN LESS THAN 30 MINUTES
Pay Attention!UseanexistingprojectinyouraccountwiththeComputeEngineAPIenabled.GCE - Application (app)Name:usa-app01Region:us-west1(Oregon)Zone:us-west1-bSize:e2-microOS:DebianGNU/Linux10(buster)GCE - Database (db)Name:usa-db01Region:us-west1(Oregon)Zone: us-west1-bSize: e2-microOS:DebianGNU/Linux10(buster)Create02instanceswithfollowingsettings:First StepsDB:Installing, Setting up and CreatingRun these commands for OS update, repository and package installation;sudo apt updatesudo apt-get -y install wgetwget http://repo.mysql.com/mysql-apt-config_0.8.13-1_all.debIntercontinental VM Migration (USA>> AUSTRALIA)Using Storage Snapshot through the GCP Internalprivate network in less than 30 minutes
Insertandrepeatthepassword:welcome1Selectdefault authentication pluginInformthepassword:welcome1AnswerN for all questionssudo dpkg -i mysql-apt-config_0.8.13-1_all.debSelectOKandgoforward.Installing MySQL Serversudo apt updatesudo apt install mysql-server -yClickonOk.SelectUse Legacy Authentication Method (Retain MySQL 5.x Compatibility)Restarting the MySQL servicesudo systemctl restart mysql.serviceSetting up the MySQLsudo mysql_secure_installationDownloading the file *.sqlwget https://storage.googleapis.com/bootcamp-gcp-en/bootcamp-gcp-storage-db-en.sqlConnecting to DBmysql -u root -ptypethepassword:welcome1Creating the 'db' and 'tables'source bootcamp-gcp-storage-db-en.sql
Creating an user and changing the privilegesCREATE USER app@'%' IDENTIFIED BY 'welcome1';GRANT ALL PRIVILEGES ON clinic.* TO app@'%';FLUSH PRIVILEGES;exitSetting up the VM for the ApplicationUpdating the OS and the packagessudo apt-get updatesudo apt-get install -y npmsudo apt-get install -y zipsudo apt-get install -y wgetCreating and accessing the folder to download application files (Node.js)wget https://storage.googleapis.com/bootcamp-gcp-en/bootcamp-gcp-storage-clinic-mid-app.zipunzip bootcamp-gcp-storage-clinic-mib-app.zipcd bootcamp-gcp-storage-clinic-mib-appFromthefolderbootcamp-gcp-storage-clinic-mid-app,runthefollowingcommandtoeditthefileindex.jsnano src/index.jsOnceinsideofthefileindex.js, intheMiddlewaressection,replace:
Name: allow-app-port-3000Targets: AllinstancesinthenetworkSource IP ranges: 0.0.0.0/0SelectTCPandtheport3000ClickonCreatehost:tothePrivate IP addressofthevmusa-db01.user:toapp,password: towelcome1database:toclinicAndsavethefile!From bootcamp-gcp-storage-clinic-mid-app folder run the command below to install theNPM package:npm installStart the Node.js application:node src/index.jsCreating a firewall rule to allow the TCP access on 3000 port!FromFirewall services, clickonCreate Firewall Rule:Copy the public IP of the instance eua-app01 and paste in the browser!After the successful access to the application,wecanstoptheVMsusa-db01andusa-app01.Migrating the VMs using the Storage SnapshotStep 1) Checkingthedisks'inuse'byVMsusa-app01andusa-db01Step 2) CreatingsnapshotfromdisksoftheVMsusa-app01andusa-DB01gcloud compute disks snapshot usa-db01 --snapshot-names usa-db01-snapshot --zone us-west1-bgcloud compute disks snapshot usa-app01 --snapshot-names usa-app01-snapshot --zone us-west1-bStep 3) Creatingdisksintheaustralia-southeast1  (Sydney)region,usingassourcethesnapshotscreatedintheus-west1 (Oregon) region.gcloud compute disks create aus-db01 --source-snapshot usa-db01-snapshot --zone australia-southeast1-agcloud compute disks create aus-app01 --source-snapshot usa-app01-snapshot --zone australia-southeast1-a
Step 4) CreatinginstancesintheSydney region,usingassourcethediskscreatedinthepreviousstep.gcloud compute instances create aus-app01 --machine-type e2-micro --zone australia-southeast1-a --disk name=aus-app01,boot=yes,mode=rwgcloud compute instances create aus-db01 --machine-type e2-micro --zone australia-southeast1-a --disk name=aus-db01,boot=yes,mode=rwStep 5)Accessingtheinstanceaus-app01viasshStep 6) Accessingthefolderbootcamp-gcp-storage-clinic-mib-appcd bootcamp-gcp-storage-clinic-mib-appStep 7)Editingthefilesrc/index.js.vi src/index.jsStep 8)IntheMiddlewares section, replace:host:totheprivate IP private of the VM aus-db01.Step 9) Starting the applicationnode src/index.jsStep 10) Accessingtheapplicationonport3000inthebrowser:http://<external-ip-from-aus-app01:3000https://cloud.google.com/compute/docs/instances/moving-instance-across-zoneshttps://cloud.google.com/compute/docs/disks/create-snapshotshttps://cloud.google.com/compute/docs/disks/snapshot-best-practicesReferences:Congratulations!!!Youhavesuccessfullycompletedthemission!!
